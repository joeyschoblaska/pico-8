pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- raycaster
-- by thrillhouse

-- [x] untextured raycasting
-- [x] wall textures
-- [x] minimap
-- [ ] sprites
-- [ ] map editor
-- [ ] title screen
-- [ ] music
-- [ ] raycasting explanation screen

#include raycaster/rays.p8
#include raycaster/movement.p8
#include raycaster/minimap.p8

function _init()
  world = {
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,2,2,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,3,0,0,0,3,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,0,0,0,1,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
  }

  pos = {x = 22, y = 12}
  dir = {x = -1, y = 0}
  plane = {x = 0, y = 0.66}

  rotSpeed = 0.01
  moveSpeed = 0.25
  minimap = false
  titleScreen = true
  showInstructions = 150
  useTextures = true
  showCPU = true
end

function _update()
  move()

  if titleScreen then
    if btnp() > 0 then
      titleScreen = false
    end
  else
    if showInstructions > 0 then showInstructions -= 1 end
  end
end

function _draw()
  cls()

  if titleScreen then
    print "press any key to start" -- placeholder
  else
    draw_rays()
    draw_minimap()

    if showInstructions > 0 then
      print("hold z / 🅾️ to strafe", 1, 1, 6)
    else
      if showCPU then print("cpu: " .. stat(1), 1, 1, 6) end
    end
  end
end

__gfx__
11111555555555155555511111111111111111111111111111111111111111110000000005400000000000000000000000000000000000000000000000000000
55555d76666665566666d15dddd555551111156dddddd11ddddd5115555111110000000005450000000000000000000000000000000000000000000000000000
666d1d666666d156dddd51d666666666ddd515dddddd511d55551156dddddddd0000000005554000000000000000000000000000000000000000000000000000
6ddd1d6dddddd11ddddd51d6ddddddddd55515d5555551155555115d555555550000000005515400000000000000000000000000000000000000000000000000
ddd5156dddddd51555551156dddddddd555111d5555551111111111d555555550000000004511500000000000000000000000000000000000000000000000000
5551156dddddd51515555556ddd55555111111d5555551111111111d555511110000000005155110100000000000000000000000000000000000000000000000
1111156dddddd5156666d15555511111111111d555555111dddd5111111111110000000015555544450000000000000000000000000000000000000000000000
111115d6ddddd51d6ddd5111111111111111115d55555115d5551111111111110000000115511144445000000000000000000000000000000000000000000000
6ddd51d6ddddd51d6ddd515655d66666d555115d55555115d555111d115ddddd0000001115152155444500000000000000000000000000000000000000000000
6d6d515ddddd55156d5551d65d666666d5d5111555551115d511115d15dddddd000001155115d555544400000000000000000000000000000000000000000000
dddd515551111115511111665d6ddddd5555111111111111111111dd15d555550000115511155511155440000000000000000000000000000000000000000000
dddd515d55515ddd666d156d5d6ddddd5555111511111555ddd511d515d555550511111111155111115445000000000000000000000000000000000000000000
dddd516666d56666666d1d6d15dddddd555511dddd51ddddddd515d51155555500001111111115d5115444000000000000000000000000000000000000000000
5551116ddd5566ddddd51d6d11111155111111d55511dd55555115d5111111110000055155115d11115544500000000000000000000000000000000000000000
1555556ddd5166ddddd51d6d15551111111111d55511dd55555515d5111111110000015551155211125154400000000000000000000000000000000000000000
d666656ddd5166ddddd51d6d1d66dd555dddd1d55511dd55555115d515dd551100000005111d5121222554450000000000000000000000000000000000000000
d6ddd56ddd51d6ddddd51d6d1ddd66555d5551d555115d55555115d51555dd110000000051115224244d15445000000000000004500000000000000045000000
d6ddd56ddd5156ddddd51d6d1d6ddd555d5551d555111d55555115d515d55511000000000551122444d511445000000000000005450000000000000441000000
d6ddd56ddd5156dd55511555155555515d5551d555111d5551111111111111110000000000551154445111444000000000000001445000000000004451000000
d6ddd5d6dd51155111111555551111115d55515d5511111111111111111111110000000000145115d51115554550000000000001144500000000144111000000
d6ddd5d6dd5115555555ddd6666666555d55515d551111111111555ddddddd510000000000054511111115555444000000000000515441155515445150000000
d6ddd1d6dd511d6666666776666666515d55515d551115d66d6d6666dddddd110000000005544551111155555444000000000000115555555555551110000000
d6dd51d6dd511d66666666dddddddd515d55115d551115dddddddd5555555511000000005555555555555ddd5444410000000000015115555551155100000000
5d55515ddd51156ddddddddddddddd511511111555111565555555555555551100000005555555555555dd555444440000000000155551155511555100000000
511111555551156ddddddddddddddd5111111111111111d5555555555555551100000004444445555dddd5551444445000000000155555555555555100000000
5ddd555111111555555ddddddddddd511555111111111111111555555555551100000054451444555ddd55515444445000000000151115555551115500000000
5666666dddddd55551111111111111151dddddd5555551111111111111111111000000054514455555dd555154444450000000005411215d5d55215500000000
56dddd666666666655555111111111551d5555dddddddddd1111111111111111000000015111115555dd55515444445000000000544555555555544400000000
56dddddddddddddd11d66655dddddd551d55555555555555115ddd11555555110000005411111555555555115444455000000000545555111155554500000000
551111155155111111dddd5d66666655111111111111111111555515ddd5dd110000000511511555555555111544445000000000545111111111154500000000
51111111111111111155111555555515111111111111111111111111111111110000000055515555555555111544445000000000545155155155154500000000
5555551111111111111511111111111511111111111111111111111111111111000000000051555555555511444e944500000000545111155511114500000000
511111111115111ccc1cccccc15111111111111111111111111111111111111100000000005555555555551144e9444500000000545111155511154500000000
1ccccc1c11111c1111c1111cc11cccc1511111111115111111111111111111150000000000155555555555111545155000000000445511111111154450000000
1c1c11111111111111111111111ccc15511111111115111111111555551111150000000000054455555555115155155000000000455555111111555450000000
1ccc11c11111ccccccccc111111cc115511111111115111111111111111111150000000000044455555511115155500000000005445555511155555441000000
1ccc111111111ccccc11c11c111ccc15511111111115111111111511111111150000000000044555551111111554500000000014444455555555555445000000
1c11111111151ccccc11111c111c1115511111111115111111111511111111150000000000044455511111111554500000000044444455555555554444000000
1c11111111111cccc111111c11111115511111111115111111111511111111150000000000144451111111111554550000000044444455555555544444500000
5111111111151c1c1111151c11111115511115555555111111111511115555550000000000544455111111111555550000000444444455dddddd554444500000
1111111111111cccc111151c11111111111111111111111111111511115111110000000000444455111111111555551000000444444455dddddd555444500000
cccc1c111cc11ccc11111511111c11cc11111111111111111111151111111111000000000144445511111111155555500000044444455555dd55555444500000
ccc111111c11111111111511111111cc11111111111111115555551155515111000000000144445511111111155555100000044444455555dd55555444500000
c1c111111111111111111111111111cc11111111111111111111111511111111000000000144445511111111155555100000044444455555dd55551444500000
c1c1111111111ccccccccc111ccc11cc111111111115111111111115111151110000000001444455111111111555555000000444445555555555511444500000
c1cc111111151cccccc111111cc111cc111111111555111111111115111151110000000005444451111111111555550000000544444555555555515444500000
cccc111111111cccccc111111cc111cc111111151111111111111115111151110000000000444451111111111555550000000544444555555555115444500000
c11111111cc11cccc1c111151cc111c1111111151111111111111115111151110000000000544451111111111555510000000544444455555555154444500000
cc1111111c111c1c111111151cc11111111111151115111111111115111151110000000000544451111111111555500000000554444451155551144445500000
111111111c111cc1111111151c1111cc111111151115111111111115111151110000000000044455151000115555000000000054444551111111144445500000
111111111c111111111155551c1111c1111111151111111555555555111151110000000000054455151000115555000000000055444455111111544445500000
111111151c111111111111111c115111111115151115111111111111111151110000000000004445151000515551000000000005444445511111444445500000
111111111c111cccccccccc11cc15115555111111115111111111115111151150000000000005445151000155550000000000001444445511115444445500000
1cccccc11c111cccc11111111c115115111111111111111111111115111151150000000000000445151000555550000000000005544445511154444455000000
1cccccc111151ccccc11111111115115111111115155111111111115111151150000000000000545511000555100000000000005544445551144444451000000
1cccccc111111ccccc11111111111115111111111111111111111115551111150000000000000545511000551100000000000005154445545544444555000000
1cccc1c11cc11ccccc1111111cccccc1111111111111111111111115111111150000000000000545510000555500000000000005554445450044445555000000
1cccc1111cc11cccccc111111ccccc15111111111111111111111115111111150000000000000545100000555500000000000005555545500044445555000000
1cccc1111cc11cc1111111151ccc1115111111111111111111111115111111150000000000000545100000155550000000000005555100000054455555000000
1cc1c1111cc11ccc1111c1151ccc1115111111111111111111111115111111150000000000001445100000055555000000000004555000000000000555000000
1cc11c111c111cc1c11111151ccc1115111111111111111111111115111111150000000000001445100000015555000000000004550000000000000555000000
1c1111111c111ccc111111151cc11115111111111115111111111115111111150000000000014445100000054444500000000144550000000000000555100000
1c11111111111cc1111111111c111111111111111111111111111111111111150000000000044455500000054444400000000444550000000000000544500000
11111111111111111111111111111115511111155115511111111115511111110000000000044555500000054444400000000444550000000000000555500000
11111111111115511111515111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
24444425444444444425444444444425122222112222222222112222222222210000000000000000000000000000000000000000000000000000000000000000
24222215422222222215422222422221122222112222222222112222222222510000000000000000000000000000000000000000000000000000000000000000
24222215422222222215222222222221122255112252555555112555525225110000000000000000000000000000000000000000000000000000000000000000
52222215222222222215222222222221125511112551111111115111151555110000000000000000000000000000000000000000000000000000000000000000
51111115511111111115515511111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
44222222524444444242444444554444222222221222222222222222221122220000000000000000000000000000000000000000000000000000000000000000
22222222122222222222222222154222225555211522255555525522251122220000000000000000000000000000000000000000000000000000000000000000
22222222122222222222222222154222221111211122511121151115211122250000000000000000000000000000000000000000000000000000000000000000
22122221122222222222222222152222551111551155111111111111111155510000000000000000000000000000000000000000000000000000000000000000
11111111555111151111111111551111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
28444424444242544444442222422225122222222222211222222222222222210000000000000000000000000000000000000000000000000000000000000000
24222222222222144222222222222221122552225525211222552555522522510000000000000000000000000000000000000000000000000000000000000000
22222222222222142222222222222221125115521151511225115111155255110000000000000000000000000000000000000000000000000000000000000000
52222222222221122222222222222221121111151111111551111111111111110000000000000000000000000000000000000000000000000000000000000000
55511115555111555155115551151551151111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
44444254444242242242544444422222222221122222222222211222222222220000000000000000000000000000000000000000000000000000000000000000
22222152222222222222542222222222222221125255255555211225522552550000000000000000000000000000000000000000000000000000000000000000
22222152222222222222542222222222252211121111211111211222222222110000000000000000000000000000000000000000000000000000000000000000
12121152222222122221122222222222115511151111511111511555555555110000000000000000000000000000000000000000000000000000000000000000
55555155115551151155555555515551111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
24444222224224225442222222222221122222222222222112222222222222210000000000000000000000000000000000000000000000000000000000000000
22222222222222211222222222222221125555555555555112255555555555510000000000000000000000000000000000000000000000000000000000000000
24222222222222221422222222222221125152251111525112211111112221110000000000000000000000000000000000000000000000000000000000000000
52222222111111211222222221211211151115511111151115511111115551110000000000000000000000000000000000000000000000000000000000000000
55555555515215555555555555511555111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
42422422212842242242222154222222222222221122222222222211122222210000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222255555551152555555555511125555510000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222511111521155111111111111121111120000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222111111151111111111111111151111150000000000000000000000000000000000000000000000000000000000000000
11111111115111111111111151111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
