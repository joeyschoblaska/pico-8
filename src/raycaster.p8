pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- raycaster
-- by thrillhouse

-- [x] untextured raycasting
-- [ ] map editor
-- [ ] wall textures
-- [ ] sprites
-- [ ] floor and ceiling textures
-- [x] minimap
-- [ ] title screen
-- [ ] music
-- [ ] raycasting explanation screen

#include raycaster/rays.p8
#include raycaster/movement.p8
#include raycaster/minimap.p8

function _init()
  world = {
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,2,2,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,3,0,0,0,3,0,0,0,1},
    {1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,0,0,0,5,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
  }

  pos = {x = 22, y = 12}
  dir = {x = -1, y = 0}
  plane = {x = 0, y = 0.66}

  rotSpeed = 0.01
  moveSpeed = 0.25
  minimap = false
  titleScreen = true
  showInstructions = 150
  useTextures = true
end

function _update()
  move()

  if titleScreen then
    if btnp() > 0 then
      titleScreen = false
    end
  else
    if showInstructions > 0 then showInstructions -= 1 end
    if btnp(5) then minimap = not minimap end
  end
end

function _draw()
  cls()

  if titleScreen then
    print "press any key to start" -- placeholder
  else
    draw_rays()
    draw_minimap()

    if showInstructions > 0 then
      print("hold z to strafe", 1, 1, 5)
      print("press x to toggle minimap", 1, 8, 5)
    end
  end
end

__gfx__
11111555555555155555511111111111000000111111100111110000000000000000000000000000000000000000000000000000000000000000000000000000
55555d76666665566666d15dddd555551111056dddddd11ddddd5015555111110000000000000000000000000000000000000000000000000000000000000000
666d1d666666d156dddd51d666666666ddd505dddddd501d55551056dddddddd0000000000000000000000000000000000000000000000000000000000000000
6ddd1d6dddddd11ddddd51d6ddddddddd55505d5555550055555005d555555550000000000000000000000000000000000000000000000000000000000000000
ddd5156dddddd51555551156dddddddd555101d5555550011000001d555555550000000000000000000000000000000000000000000000000000000000000000
5551156dddddd51515555556ddd55555111001d5555550000011101d555511110000000000000000000000000000000000000000000000000000000000000000
1111156dddddd5156666d15555511111000000d555555001dddd5001100000000000000000000000000000000000000000000000000000000000000000000000
111115d6ddddd51d6ddd5111111111110000005d55555005d5551000000000000000000000000000000000000000000000000000000000000000000000000000
6ddd51d6ddddd51d6ddd515655d66666d555105d55555105d555101d115ddddd0000000000000000000000000000000000000000000000000000000000000000
6d6d515ddddd55056d5551d65d666666d5d5101555551005d511005d05dddddd0000000000000000000000000000000000000000000000000000000000000000
dddd515551111005511111665d6ddddd5555100000000000100000dd05d555550000000000000000000000000000000000000000000000000000000000000000
dddd515d55515ddd666d156d5d6ddddd5555001511001555ddd501d505d555550000000000000000000000000000000000000000000000000000000000000000
dddd516666d56666666d1d6d15dddddd555500dddd50ddddddd505d5015555550000000000000000000000000000000000000000000000000000000000000000
5551116ddd5566ddddd51d6d11111155110000d55510dd55555105d5000000000000000000000000000000000000000000000000000000000000000000000000
1555556ddd5166ddddd51d6d15551111001110d55510dd55555505d5000000000000000000000000000000000000000000000000000000000000000000000000
d666656ddd5166ddddd51d6d1d66dd555dddd1d55510dd55555105d505dd55100000000000000000000000000000000000000000000000000000000000000000
d6ddd56ddd51d6ddddd51d6d1ddd66555d5551d555105d55555105d50555dd100000000000000000000000000000000000000000000000000000000000000000
d6ddd56ddd5156ddddd51d6d1d6ddd555d5551d555101d55555005d505d555100000000000000000000000000000000000000000000000000000000000000000
d6ddd56ddd5156dd55511555155555515d5551d555100d5551100110011111100000000000000000000000000000000000000000000000000000000000000000
d6ddd5d6dd51155111111555551111115d55515d5510011000000000000000000000000000000000000000000000000000000000000000000000000000000000
d6ddd5d6dd5115555555ddd6666666555d55505d551001111111555ddddddd500000000000000000000000000000000000000000000000000000000000000000
d6ddd1d6dd511d6666666776666666515d55505d551005d66d6d6666dddddd100000000000000000000000000000000000000000000000000000000000000000
d6dd51d6dd510d66666666dddddddd515d55105d551005dddddddd55555555100000000000000000000000000000000000000000000000000000000000000000
5d55515ddd51056ddddddddddddddd51151100155510056555555555555555100000000000000000000000000000000000000000000000000000000000000000
511111555551056ddddddddddddddd5100000000000001d555555555555555100000000000000000000000000000000000000000000000000000000000000000
5ddd555111111555555ddddddddddd51155511000000001000155555555555000000000000000000000000000000000000000000000000000000000000000000
5666666dddddd55551111111111111151dddddd55555511100000000000000000000000000000000000000000000000000000000000000000000000000000000
56dddd666666666655555111111111551d5555dddddddddd10010000000000000000000000000000000000000000000000000000000000000000000000000000
56dddddddddddddd11d66655dddddd551d55555555555555005ddd11555555100000000000000000000000000000000000000000000000000000000000000000
551111155155111111dddd5d66666655110000000000000000555515ddd5dd100000000000000000000000000000000000000000000000000000000000000000
51111111111111111155111555555515000000000000000000000001111111000000000000000000000000000000000000000000000000000000000000000000
55555511111111111115111111111115000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
511111111115111ccc1cccccc1511111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
1ccccc1c11111c1111c1111cc11cccc1011111111110111111111111111111100000000000000000000000000000000000000000000000000000000000000000
1c1c11111111111111111111111ccc10011111111110111111111000001111100000000000000000000000000000000000000000000000000000000000000000
1ccc11c11111ccccccccc111111cc110011111111110111111111111111111100000000000000000000000000000000000000000000000000000000000000000
1ccc111111111ccccc11c11c111ccc10011111111110111111111011111111100000000000000000000000000000000000000000000000000000000000000000
1c11111111101ccccc11111c111c1110011111111110111111111011111111100000000000000000000000000000000000000000000000000000000000000000
1c11111111111cccc111111c11111110011111111110111111111011111111100000000000000000000000000000000000000000000000000000000000000000
0111111111101c1c1111101c11111110011110000000111111111011110000000000000000000000000000000000000000000000000000000000000000000000
1111111111111cccc111101c11111111111111111111111111111011110111110000000000000000000000000000000000000000000000000000000000000000
cccc1c111cc11ccc11111011111c11cc111111111111111111111011111111110000000000000000000000000000000000000000000000000000000000000000
ccc111111c11111111111011111111cc111111111111111100000011000101110000000000000000000000000000000000000000000000000000000000000000
c1c111111111111111111111111111cc111111111111111111111110111111110000000000000000000000000000000000000000000000000000000000000000
c1c1111111111ccccccccc111ccc11cc111111111110111111111110111101110000000000000000000000000000000000000000000000000000000000000000
c1cc111111101cccccc111111cc111cc111111111000111111111110111101110000000000000000000000000000000000000000000000000000000000000000
cccc111111111cccccc111111cc111cc111111101111111111111110111101110000000000000000000000000000000000000000000000000000000000000000
c11111111cc11cccc1c111101cc111c1111111101111111111111110111101110000000000000000000000000000000000000000000000000000000000000000
cc1111111c111c1c111111101cc11111111111101110111111111110111101110000000000000000000000000000000000000000000000000000000000000000
111111111c111cc1111111101c1111cc111111101110111111111110111101110000000000000000000000000000000000000000000000000000000000000000
111111111c111111111100001c1111c1111111101111111000000000111101110000000000000000000000000000000000000000000000000000000000000000
111111101c111111111111111c110111111110101110111111111111111101110000000000000000000000000000000000000000000000000000000000000000
111111111c111cccccccccc11cc10110000111111110111111111110111101100000000000000000000000000000000000000000000000000000000000000000
1cccccc11c111cccc11111111c110110111111111111111111111110111101100000000000000000000000000000000000000000000000000000000000000000
1cccccc111101ccccc11111111110110111111110100111111111110111101100000000000000000000000000000000000000000000000000000000000000000
1cccccc111111ccccc11111111111110111111111111111111111110001111100000000000000000000000000000000000000000000000000000000000000000
1cccc1c11cc11ccccc1111111cccccc1111111111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1cccc1111cc11cccccc111111ccccc10111111111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1cccc1111cc11cc1111111101ccc1110111111111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1cc1c1111cc11ccc1111c1101ccc1110111111111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1cc11c111c111cc1c11111101ccc1110111111111111111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1c1111111c111ccc111111101cc11110111111111110111111111110111111100000000000000000000000000000000000000000000000000000000000000000
1c11111111111cc1111111111c111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000
ddddddddddddddddddddddddddddddd5511111155115511111111115511111110000000000000000000000000000000000000000000000000000000000000000
11111111111115511111515111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
24444425444444444425444444444425022222002222222222002222222222200000000000000000000000000000000000000000000000000000000000000000
24222205422222222215422222422221022222002222222222002222222222000000000000000000000000000000000000000000000000000000000000000000
24222205422222222215222222222221022200002202000000002000020220000000000000000000000000000000000000000000000000000000000000000000
52222205222222222205222222222221020000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
51111115511111111115515511111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44222222524444444242444444554444222222220222222222222222220022220000000000000000000000000000000000000000000000000000000000000000
22222222122222222222222222154222220000200022200000020022200022220000000000000000000000000000000000000000000000000000000000000000
22222222122222222222222222154222220000200022000020000000200022200000000000000000000000000000000000000000000000000000000000000000
22022220122222222222222222152222000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111555111151111111111551111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
28444424444242544444442222422225122222222222200222222222222222200000000000000000000000000000000000000000000000000000000000000000
24222222222222144222222222222221022002220020200222002000022022000000000000000000000000000000000000000000000000000000000000000000
22222222222222142222222222222221020000020000000220000000000200000000000000000000000000000000000000000000000000000000000000000000
52222222222220122222222222222221020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55511115555111555155115551151551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444254444242242242544444422222222220022222222222200222222222220000000000000000000000000000000000000000000000000000000000000000
22222052222222222222542222222222222220020200200000200220022002000000000000000000000000000000000000000000000000000000000000000000
22222052222222222222542222222222202200020000200000200222222222000000000000000000000000000000000000000000000000000000000000000000
02020052222222022220122222222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555155115551151155555555515551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
24444222224224225442222222222221022222222222222002222222222222200000000000000000000000000000000000000000000000000000000000000000
22222222222222201222222222222221020000000000000002200000000000000000000000000000000000000000000000000000000000000000000000000000
24222222222222221422222222222221020002200000020002200000002220000000000000000000000000000000000000000000000000000000000000000000
52222222000000201222222220200201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555515215555555555555511555000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
42422422212842242242222154222222222222220022222222222200022222200000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222200000000002000000000000120000000000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222000000020000000000000000020000020000000000000000000000000000000000000000000000000000000000000000
22222222212222222222222152222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111115111111111111151111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555010011111111111111100010111110110000000000000000000000000000000000000000000000000000000000000000
